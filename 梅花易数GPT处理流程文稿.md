# 梅花易数GPT处理流程文稿

## 流程概述
详细记录了梅花易数从用户输入到GPT API调用，再到最终卦象答案返回的完整处理流程。

---

## 🔄 完整处理流程

### 阶段一：用户输入处理

#### 1.1 问题识别与分类
**触发条件**：用户点击"获得启示"按钮

**处理逻辑**：
```javascript
// 判断问题类型
if (this.currentQuestion && this.currentQuestion.startsWith('梅花易数预测')) {
    // 梅花易数预测处理流程
    this.generateWithAI();
} else {
    // 普通感应答案处理流程
    this.generateWithAI();
}
```

**分类标准**：
- **梅花易数**：问题以"梅花易数预测"开头
- **感应答案**：其他所有问题类型

#### 1.2 数据预处理
**梅花易数数据收集**：
```javascript
const plumBlossomData = {
    event: this.plumBlossomData.event,        // 用户输入的事件内容
    time: this.plumBlossomData.time,          // 当前时间
    randomNumber: this.plumBlossomData.randomNumber  // 随机生成的数字
};
```

---

### 阶段二：Prompt构建

#### 2.1 梅花易数模式Prompt构建

**System Prompt（系统提示）**：
```
你是一位精通梅花易数的玄学大师。请根据用户提供的时间、随机数和事件内容，生成简洁的卦象分析。只需提供：
1）主要卦象名称
2）核心寓意或指引方向

建议回答保持在50字以内，如实反映卦象含义。如果卦象显示不利情况，可以在最后加上"事在人为"作为鼓励，但不作为主要表达内容。
```

**User Prompt（用户提示）**：
```
事件内容：[用户输入的事件内容]
预测时间：[格式化的当前时间，如：2024-11-13 15:30]
随机数字：[随机生成的数字]

请提供简洁的卦象分析。
```

#### 2.2 感应答案模式Prompt构建

**System Prompt（系统提示）**：
```
你是一本古老的答案之书的守护精灵。你的职责不是根据问题生成答案，而是根据问题类型从对应的分类答案库中随机选择现成的答案。这些答案就像实体答案之书上的文字，每次翻阅都会在不同的问题背景下产生新的联想和启示。

**答案分类使用规则**：
1. 检测用户问题类型（职场、情感、琐事）
2. 根据问题类型从对应分类的答案库中选择
3. 可以从通用答案库中选择跨越不同类型使用

**职场类答案库（85个）**：
1. 机会总是留给有准备的人
2. 磨刀不误砍柴工
3. 工欲善其事，必先利其器
4. 千里之行，始于足下
5. 一分耕耘，一分收获
6. 天道酬勤
7. 厚德载物
8. 水滴石穿
9. 聚沙成塔
10. 细节决定成败
11. 慢工出细活
12. 坚持不一定胜利，但放弃一定失败
13. 万事开头难
14. 书山有路勤为径
15. 学海无涯苦作舟
16. 临渊羡鱼，不如退而结网
17. 授人以鱼不如授人以渔
18. 青出于蓝而胜于蓝
19. 失败是成功之母
20. 有时候失败是为了更大的成功
21. 塞翁失马，焉知非福
22. 物极必反，否极泰来
23. 静下心来，世界会变得更清晰
24. 相信过程比相信结果更重要
25. 有时候后退是为了更好地前进
26. 换个环境可能会有新发现
27. 跳出框架思考
28. 不如换一种角度思考
29. 重新定义这个问题会更有趣
30. 答案可能就在下一个转角
31. 看似无关的事物往往暗含线索
32. 倾听内心的声音，即使它很轻很轻
33. 跟随你的直觉，虽然直觉有时会撒谎
34. 锋芒毕露不如内敛含蓄
35. 小心驶得万年船
36. 种什么因，得什么果
37. 非黑即白的答案往往最可靠
38. 先做你能做的，其余的交给时间
39. 每个选择都有其存在的理由
40. 有时候不选择也是一种选择
41. 等待让决定自然浮现
42. 答案在水到渠成时自然出现
43. 时间会给出最好的答案
44. 好事多磨，急不得
45. 一切都是最好的安排
46. 顺其自然比强求更有效
47. 最艰难的时刻往往是最关键的时刻
48. 机会在于把握，不在于等待
49. 能力需要展现，但更需要坚持
50. 团队协作胜过个人英雄主义
51. 沟通是解决问题的第一步
52. 谦逊是进步的开始
53. 批评是改进的机会
54. 目标明确才能事半功倍
55. 执行力决定竞争力
56. 创新思维是突破的关键
57. 经验是最好的老师
58. 学习永无止境
59. 专注能创造奇迹
60. 耐心等待时机成熟
61. 行动胜过千言万语
62. 责任担当是成长的标志
63. 合作共赢是大势所趋
64. 持续改进是成功的保证
65. 目标分解，化整为零
66. 从小事做起，积累大成
67. 困难是成长的阶梯
68. 挫折是成功的垫脚石
69. 态度决定高度
70. 格局决定结局
71. 思路决定出路
72. 选择比努力更重要
73. 定位决定地位
74. 思维决定行为
75. 观念决定方向
76. 格局决定结局
77. 心胸决定格局
78. 眼光决定未来
79. 视野决定境界
80. 心态决定状态
81. 习惯决定命运
82. 性格决定成败
83. 品格决定高度
84. 素养决定影响力
85. 格局决定影响力

**情感类答案库（85个）**：
1. 百年修得同船渡
2. 缘分天注定，相守靠人心
3. 善有善报，恶有恶报
4. 得饶人处且饶人
5. 己所不欲，勿施于人
6. 真诚是情感的基础
7. 理解是沟通的桥梁
8. 信任是关系的纽带
9. 包容是爱的表现
10. 耐心是感情的考验
11. 倾听比说话更重要
12. 陪伴是最长情的告白
13. 相濡以沫，不离不弃
14. 心有灵犀一点通
15. 患难见真情
16. 日久见人心
17. 真心换真心
18. 感情需要经营
19. 爱情需要面包，更需要信任
20. 家庭和睦万事兴
21. 家有一老，如有一宝
22. 孝顺父母是最大的福报
23. 兄弟齐心，其利断金
24. 朋友是另一个自己
25. 友谊天长地久
26. 知音难觅，真情可贵
27. 感恩的心，珍惜身边的人
28. 宽恕别人，善待自己
29. 放下执念，获得自由
30. 宽容是美德
31. 理解和包容是情感的真谛
32. 真诚待人，温暖自己
33. 善良的人运气不会太差
34. 付出总会有回报
35. 爱出者爱返，福往者福来
36. 修己以安人
37. 德厚流光，家和业兴
38. 夫妻相敬如宾
39. 相敬如宾，举案齐眉
40. 夫妻本是同林鸟
41. 孩子的笑容是家的阳光
42. 家和万事兴
43. 亲情无价
44. 血浓于水
45. 打断骨头连着筋
46. 亲情是最牢固的纽带
47. 兄弟姐妹情深
48. 长幼有序，和睦相处
49. 百善孝为先
50. 老人是家庭的财富
51. 孩子是家庭的希望
52. 教育是最好的投资
53. 言传身教，以身作则
54. 爱心是教育的灵魂
55. 尊重孩子的个性发展
56. 陪伴是最好的教育
57. 理解是沟通的开始
58. 沟通是解决问题的关键
59. 换位思考才能相互理解
60. 站在对方的角度想想
61. 不要用爱的名义伤害
62. 爱的表达方式很重要
63. 感情需要表达，更需要行动
64. 细节体现真情
65. 小别胜新婚
66. 距离产生美
67. 感情需要保鲜
68. 珍惜当下，把握幸福
69. 感情路上不要急
70. 真爱需要等待
71. 有情人终成眷属
72. 爱情是两个人共同成长
73. 互相支持，共同进步
74. 爱情需要共同的价值观
75. 相知相守，白头偕老
76. 感情需要责任和担当
77. 承诺是用行动兑现的
78. 忠诚是感情的底线
79. 专一是感情的基石
80. 真挚的感情经得起考验
81. 时间会证明一切
82. 真心永远不会错付
83. 爱情没有标准答案
84. 每个感情都是独特的
85. 用心感受，用爱经营

**日常琐事类答案库（80个）**：
1. 生活需要仪式感
2. 慢生活，享受当下
3. 简单就是幸福
4. 知足者常乐
5. 平凡的日子也有诗意
6. 每天都是新的开始
7. 生活需要一点小惊喜
8. 保持童心，生活更有趣
9. 健康是最大的财富
10. 早睡早起身体好
11. 运动让你更年轻
12. 饮食有节，起居有常
13. 适当放松很重要
14. 休息是为了更好地工作
15. 劳逸结合效率高
16. 养成良好的生活习惯
17. 细节决定生活品质
18. 整洁的环境带来好心情
19. 房间要常清理，心情要常梳理
20. 断舍离让生活更轻松
21. 极简生活，品质人生
22. 少即是多
23. 适合自己的才是最好的
24. 花钱要花在刀刃上
25. 量入为出最稳妥
26. 投资自己永远不会错
27. 学习是最好的投资
28. 阅读让你更有内涵
29. 多出去走走，开阔眼界
30. 世界那么大，要去看看
31. 旅行是最好的老师
32. 读万卷书，行万里路
33. 与其宅在家里，不如出门走走
34. 亲近大自然，放松身心
35. 阳光能驱散阴霾
36. 绿植能净化空气
37. 养个小宠物作伴
38. 兴趣爱好丰富生活
39. 培养一个终身爱好
40. 音乐能治愈心灵
41. 艺术让生活更美好
42. 手工制作有成就感
43. 烹饪是生活的艺术
44. 美食能治愈一切
45. 和朋友聚餐是快乐源泉
46. 独处也是一种享受
47. 学会与自己和解
48. 内心的平静最珍贵
49. 冥想能净化心灵
50. 感恩生活中的美好
51. 每天给自己一个微笑
52. 正能量会传染
53. 保持乐观的心态
54. 笑一笑，十年少
55. 压力需要释放
56. 学会说"不"很重要
57. 不要把别人的评价看得太重
58. 做自己最快乐
59. 不要总是与别人比较
60. 专注于自己的成长
61. 每个阶段都有它的美好
62. 接受不完美的自己
63. 慢慢来，比较快
64. 有些事急不得
65. 顺其自然，水到渠成
66. 车到山前必有路
67. 天无绝人之路
68. 办法总比困难多
69. 没有过不去的坎
70. 困难是暂时的
71. 坚持就是胜利
72. 困难是最好的老师
73. 失败是成功的必经之路
74. 跌倒了就爬起来
75. 勇敢面对现实
76. 接受无法改变的
77. 改变能够改变的
78. 智慧在于分辨二者的区别
79. 生活的智慧在于平衡
80. 平凡的快乐最真实

**通用答案库（50个）**：
1. 选一个轻松一些的
2. 相信直觉的力量
3. 答案就在你心中
4. 跟随内心的声音
5. 不要想太多，行动最重要
6. 换个角度看问题
7. 时间会给出最好的答案
8. 一切都是最好的安排
9. 静待花开
10. 车到山前必有路
11. 船到桥头自然直
12. 否极泰来
13. 物极必反
14. 塞翁失马，焉知非福
15. 失之东隅，收之桑榆
16. 柳暗花明又一村
17. 山重水复疑无路
18. 守得云开见月明
19. 皇天不负有心人
20. 功夫不负有心人
21. 有志者事竟成
22. 精诚所至，金石为开
23. 滴水穿石
24. 聚沙成塔
25. 积少成多
26. 千里之行，始于足下
27. 不积跬步，无以至千里
28. 磨刀不误砍柴工
29. 工欲善其事，必先利其器
30. 临渊羡鱼，不如退而结网
31. 授人以鱼不如授人以渔
32. 给人玫瑰，手有余香
33. 助人即助己
34. 善有善报
35. 种瓜得瓜，种豆得豆
36. 种什么因，得什么果
37. 厚德载物
38. 德厚流光
39. 上善若水
40. 厚德载物
41. 天道酬勤
42. 地道酬善
43. 人道酬诚
44. 商道酬信
45. 君子以厚德载物
46. 厚德载物，宁静致远
47. 德厚流光，家和业兴
48. 德高望重，众望所归
49. 德馨品高，志存高远
50. 德才兼备，方得始终

请根据检测到的问题类型，从对应分类的答案库中选择答案，或者从通用答案库中选择跨类型答案。
```

**User Prompt（用户提示）**：
```
请从上面的答案库中随机选择一个答案回答我，不需要考虑我的问题内容。
```

---

### 阶段三：GPT API调用

#### 3.1 API配置
```javascript
// API配置信息
const apiKey = 'sk-tdhjhFmizAl4soeNFdOgeYVvhZebLFBO8E0gMQ29xbEFEs1E';
const url = 'https://api.chatanywhere.tech/v1/chat/completions';
const model = 'gpt-3.5-turbo';

// 超时控制
const controller = new AbortController();
const timeoutId = setTimeout(() => controller.abort(), 30000); // 30秒超时
```

#### 3.2 请求参数
```javascript
const requestBody = {
    model: model,
    messages: [
        { role: 'system', content: systemPrompt },
        { role: 'user', content: userPrompt }
    ],
    stream: true,
    temperature: 0.7
};
```

#### 3.3 API调用
```javascript
const response = await fetch(url, {
    method: 'POST',
    headers: {
        'Content-Type': 'application/json',
        'Authorization': `Bearer ${apiKey}`
    },
    body: JSON.stringify(requestBody),
    signal: controller.signal
});
```

---

### 阶段四：响应处理

#### 4.1 流式响应解析
```javascript
// 流式读取响应
while (true) {
    const { done, value } = await reader.read();
    
    if (done) {
        break;
    }
    
    // 解码并处理流式数据
    const chunk = decoder.decode(value, { stream: true });
    const lines = chunk.split('\n');
    
    for (const line of lines) {
        if (line.trim().startsWith('data:')) {
            const data = line.trim().substring(5);
            
            if (data === '[DONE]') {
                break;
            }
            
            try {
                const parsed = JSON.parse(data);
                if (parsed.choices && parsed.choices[0] && parsed.choices[0].delta && parsed.choices[0].delta.content) {
                    fullResponse += parsed.choices[0].delta.content;
                }
            } catch (e) {
                console.error('解析流式数据失败:', e);
            }
        }
    }
}
```

#### 4.2 响应后处理
```javascript
// 等待最小停留时间（保证用户体验）
await minDelayPromise;

// 设置最终答案
this.currentRevelation = fullResponse.trim() || this.getDefaultRevelation();
```

---

### 阶段五：答案格式化

#### 5.1 梅花易数答案格式化
```javascript
formatPlumBlossomOutput: function(text) {
    // 基本格式化处理
    let formatted = text.trim();
    
    // 移除可能的冗余前缀
    const prefixes = ['梅花易数预测结果：', '根据梅花易数分析：', '卦象推断：'];
    for (const prefix of prefixes) {
        if (formatted.startsWith(prefix)) {
            formatted = formatted.substring(prefix.length).trim();
            break;
        }
    }
    
    // 如果卦象内容显示不利情况，在最后添加鼓励话语
    const negativeWords = ['不吉', '凶', '困难', '失败', '阻碍', '不利', '挫折'];
    const hasNegativeContent = negativeWords.some(neg => formatted.includes(neg));
    
    if (hasNegativeContent && !formatted.includes('事在人为')) {
        // 检查是否已经有鼓励性结尾
        if (!/[。！？]$/.test(formatted.trim())) {
            formatted += '。';
        }
        formatted += '事在人为。';
    }
    
    // 如果格式化后的内容为空，返回默认内容
    if (!formatted) {
        return '卦象显示当前情况复杂，需要谨慎应对。事在人为。';
    }
    
    // 限制长度并确保结尾标点
    if (formatted.length > 100) {
        formatted = formatted.substring(0, 100) + '...';
    }
    
    if (!/[。！？]$/.test(formatted)) {
        formatted += '。';
    }
    
    return formatted;
}
```

#### 5.2 感应答案处理
```javascript
// 感应答案直接从15个固定答案中选择，无需特殊格式化
```

---

### 阶段六：UI展示

#### 6.1 显示流程
```javascript
// 隐藏过渡模块，显示答案模块
this.hideTransitionModule();
this.showRevelationModule();

// 使用打字机效果显示启示
this.typewriterEffect(this.currentRevelation);

// 更新收藏按钮状态
this.updateCollectionButtonState();
```

#### 6.2 打字机效果
```javascript
typewriterEffect: function(text) {
    let index = 0;
    this.revelationText.textContent = '';
    
    const type = () => {
        if (index < text.length) {
            this.revelationText.textContent += text.charAt(index);
            index++;
            setTimeout(type, 50 + Math.random() * 100); // 随机速度，更自然
        }
    };
    
    type();
}
```

---

## 🛡️ 错误处理机制

### API调用失败处理
```javascript
try {
    // GPT API调用逻辑
} catch (error) {
    console.error('AI API调用失败:', error);
    
    // API调用失败，使用降级方案
    this.generateRevelationWithPreset();
}
```

### 降级方案
```javascript
generateRevelationWithPreset: function() {
    // 根据问题类型选择分类答案
    const answersByCategory = this.getAnswersByCategory();
    
    // 模拟延迟
    setTimeout(() => {
        // 从对应分类的答案中随机选择
        const availableAnswers = answersByCategory;
        const randomAnswer = availableAnswers[Math.floor(Math.random() * availableAnswers.length)];
        
        this.currentRevelation = randomAnswer;
        
        // 正常显示流程
        this.hideTransitionModule();
        this.showRevelationModule();
        this.typewriterEffect(this.currentRevelation);
        this.updateCollectionButtonState();
    }, 2000);
}

// 根据问题类型获取对应分类答案
getAnswersByCategory: function() {
    // 职场类答案库（85个）
    const jobAnswers = [
        "职场如棋，每一步都需要深思熟虑",
        "机会总是留给有准备的人，当前正是展现之时",
        "职场竞争激烈，但你的能力是最大的优势",
        "在职场中，耐心和坚持比聪明更重要",
        "选择一个方向，专注深耕必有收获",
        "职场的人际关系如棋局，需要智慧经营",
        "你的努力不会白费，时间会证明一切",
        "在职场中，保持学习的态度是成功的关键",
        "每个挑战都是成长的机会",
        "职场如战场，但要用智慧而非蛮力",
        "选择比努力更重要，方向决定命运",
        "在职场中，真诚比技巧更有效",
        "你的价值不在于证明自己，而在于创造价值",
        "职场生涯需要规划，但也要保持灵活性",
        "与人为善，广结善缘，职场路会更宽",
        "在职场中，适当的示弱比逞强更明智",
        "专业能力是你的立身之本",
        "职场需要团队合作，但也要保持独立思考",
        "每一个小步骤都可能是成功的起点",
        "在职场中，学会拒绝同样重要",
        "你的梦想值得为之付出努力",
        "职场如修行，每一步都是历练",
        "在职场中，保持初心比追求成功更重要",
        "机遇稍纵即逝，要善于把握",
        "职场需要策略，但更需要真诚",
        "你的选择决定了你的高度",
        "在职场中，学习他人优点是捷径",
        "坚持自己的原则比迎合他人更重要",
        "职场生涯需要耐心，急躁只会坏事",
        "在职场中，用结果说话最有力",
        "你的专业素养是最大的竞争力",
        "职场需要目标，但也要接受变化",
        "每一个挫折都是成功路上的垫脚石",
        "在职场中，与优秀的人为伍",
        "职场智慧在于平衡艺术",
        "你的态度决定你的高度",
        "在职场中，保持谦逊比展现才华更重要",
        "职场成功需要机遇，更需要能力",
        "在职场中，直面挑战才能成长",
        "你的决定会塑造你的未来",
        "职场如舞台，每个人都有发光的机会",
        "在职场中，保持理性比感性更重要",
        "职场需要策略规划，也需要灵活应变",
        "每一个选择都影响着你的人生轨迹",
        "在职场中，用心做事比用力做事更重要",
        "职场成功没有标准答案，但有正确方向",
        "在职场中，能力是硬实力，人品是软实力",
        "你的执着终会得到回报",
        "职场如战场，但要以德服人",
        "在职场中，明确目标比盲目努力更重要",
        "职场需要经验，更需要创新思维",
        "每一个决定都承载着未来的可能性",
        "在职场中，学会借力比独自拼搏更聪明",
        "职场需要竞争，但更需要合作",
        "你的选择体现了你的格局",
        "在职场中，坚持学习是永恒的主题",
        "职场成功需要天赋，更需要坚持",
        "在职场中，用结果证明自己的价值",
        "你的执着和努力不会白费",
        "职场如棋局，需要运筹帷幄",
        "在职场中，保持专业态度是基本要求",
        "职场需要目标导向，也需要过程管理",
        "每一个机会都可能是转折点",
        "在职场中，用实力赢得尊重",
        "职场需要策略，更需要执行力",
        "你的专业能力是最好的名片",
        "在职场中，保持工作热情很重要",
        "职场成功需要方法，更需要坚持",
        "在职场中，学会权衡利弊很重要",
        "你的选择决定了你的位置",
        "职场如修行，每一步都是成长",
        "在职场中，保持积极心态是成功关键",
        "职场需要智慧决策，也需要果断执行",
        "每一个挑战都是证明自己的机会",
        "在职场中，用专业赢得信任",
        "职场需要努力，更需要策略",
        "你的执着和热情会感染他人",
        "在职场中，适时展现自己的才华",
        "职场如战场，但要用智慧取胜",
        "在职场中，保持学习能力比现有知识更重要",
        "职场成功需要机遇，更需要准备"
    ];
    
    // 情感类答案库（85个）
    const loveAnswers = [
        "感情如水，需要用心去感受",
        "真心换真心，感情需要真诚",
        "爱情需要经营，但不要刻意",
        "感情中的误会总会有化解的一天",
        "真正的爱是成全，不是占有",
        "感情需要时间，时间会证明一切",
        "在感情中，信任比爱更重要",
        "真心喜欢一个人的感觉最美",
        "感情路上会有风雨，但彩虹终会出现",
        "爱一个人就是要包容他的全部",
        "感情需要沟通，理解是最好的桥梁",
        "真正的感情经得起时间考验",
        "感情中的痛苦往往来自于执着",
        "放下执念，才能获得内心的平静",
        "感情是两个人共同经营的事业",
        "在感情中，互相理解比互相爱更重要",
        "感情如酒，越陈越香",
        "真正的爱是无条件的",
        "感情需要包容，但也有底线",
        "在感情中，学会倾听比表达更重要",
        "感情是前世修来的缘分",
        "真心换真心，假意换假意",
        "感情中的成长往往伴随着痛苦",
        "在感情中，学会放手比坚持更需要智慧",
        "感情如花，需要用心浇灌",
        "真正的爱是给对方自由",
        "感情需要付出，但不要失去自我",
        "在感情中，诚实比美丽更重要",
        "感情是两个人的舞蹈，需要配合",
        "真正的感情不求回报",
        "感情需要耐心，急躁只会坏事",
        "在感情中，学会感恩比抱怨更重要",
        "感情如茶，需要细细品味",
        "真正的爱是默默付出",
        "感情中的快乐来自于分享",
        "在感情中，学会包容缺点很重要",
        "感情是生命中最美好的礼物",
        "真心喜欢就不会轻易放弃",
        "感情需要信任，猜疑只会伤人",
        "在感情中，保持独立很重要",
        "感情如诗，需要用心去读",
        "真正的感情经得起离别",
        "感情是前世的情，今生的债",
        "在感情中，学会沟通是必修课",
        "感情需要仪式感，但更要真心",
        "真正的爱是心灵相通",
        "感情中的成长需要彼此成就",
        "在感情中，学会换位思考很重要",
        "感情是生命中最温暖的阳光",
        "真心喜欢就会主动关心",
        "感情需要經營，但不要算計",
        "在感情中，保持新鲜感很重要",
        "感情如画，需要用心描绘",
        "真正的爱是永恒的承诺",
        "感情中的甜蜜需要分享",
        "在感情中，学会独立比依赖更重要",
        "感情是人生最美好的章节",
        "真心喜欢就会想给他最好的",
        "感情需要理解，理解需要时间",
        "在感情中，学会道歉是智慧",
        "感情如音乐，需要和谐共鸣",
        "真正的爱是尊重对方的选择",
        "感情中的快乐时光要珍惜",
        "在感情中，学会支持很重要",
        "感情是两个人共同编织的梦",
        "真心喜欢就会包容一切",
        "感情需要浪漫，但更需要实际",
        "在感情中，学会成长是必然",
        "感情如星辰，照亮彼此的人生",
        "真正的爱是无私的奉献",
        "感情中的痛苦教会我们成长",
        "在感情中，学会沟通比争论更重要",
        "感情是人生最珍贵的财富",
        "真心喜欢就会不离不弃",
        "感情需要经营，更需要缘分",
        "在感情中，学会珍惜当下很重要",
        "感情如春风，温暖人心",
        "真正的爱是永恒不变的",
        "感情中的甜蜜要用心体会",
        "在感情中，学会理解比改变更重要",
        "感情是两个人心灵的契合",
        "真心喜欢就会愿意等待",
        "感情需要信任，更需要行动",
        "在感情中，学会包容比计较更重要",
        "感情如阳光，照亮生活",
        "真正的爱是成全彼此的梦想"
    ];
    
    // 日常琐事类答案库（80个）
    const dailyAnswers = [
        "小事不小，细节决定成败",
        "生活如茶，需要慢慢品味",
        "每个平凡的日子都有不平凡的意义",
        "生活需要仪式感，但不要过度",
        "简单的生活往往最珍贵",
        "在生活中，学会取舍很重要",
        "生活如书，每一页都有故事",
        "日常琐事也有其存在的价值",
        "在生活中，保持积极心态很重要",
        "生活需要计划，但也要接受变化",
        "每个选择都影响生活质量",
        "在生活中，学会放下很重要",
        "生活如画，需要用心描绘",
        "日常生活的快乐来自小确幸",
        "在生活中，保持规律很重要",
        "生活需要努力，但不要拼命",
        "每个决定都承载着期望",
        "在生活中，学会感恩很重要",
        "生活如歌，需要和谐旋律",
        "日常琐事是生活的组成部分",
        "在生活中，保持平衡很重要",
        "生活需要目标，但不要被目标绑架",
        "每个选择都有其合理性",
        "在生活中，学会放松很重要",
        "生活如茶，需要细细品味",
        "日常生活的智慧来自体验",
        "在生活中，保持好奇心很重要",
        "生活需要意义，但不要刻意寻找",
        "每个决定都值得被尊重",
        "在生活中，学会倾听很重要",
        "生活如花，需要精心呵护",
        "日常琐事构成了生活的基础",
        "在生活中，保持诚实很重要",
        "生活需要梦想，但不要脱离现实",
        "每个选择都反映内心需求",
        "在生活中，学会分享很重要",
        "生活如音乐，需要用心聆听",
        "日常生活的温暖来自关怀",
        "在生活中，保持善良很重要",
        "生活需要自由，但不要放纵",
        "每个决定都影响人生轨迹",
        "在生活中，学会坚持很重要",
        "生活如云，变幻无常",
        "日常琐事中蕴含人生智慧",
        "在生活中，保持耐心很重要",
        "生活需要激情，但不要冲动",
        "每个选择都有其意义",
        "在生活中，学会包容很重要",
        "生活如水，利万物而不争",
        "日常生活的快乐源于内心",
        "在生活中，保持谦逊很重要",
        "生活需要方向，但不要僵化",
        "每个决定都承载着责任",
        "在生活中，学会适应很重要",
        "生活如风，来去自如",
        "日常琐事是生活的调味剂",
        "在生活中，保持热情很重要",
        "生活需要挑战，但不要自虐",
        "每个选择都值得被理解",
        "在生活中，学会成长很重要",
        "生活如诗，需要用心品读",
        "日常生活的美好需要发现",
        "在生活中，保持真实很重要",
        "生活需要惊喜，但不要惊吓",
        "每个决定都反映价值观",
        "在生活中，学会感恩很重要",
        "生活如镜，映照内心",
        "日常琐事中蕴含哲理",
        "在生活中，保持乐观很重要",
        "生活需要行动，但不要盲动",
        "每个选择都体现品格",
        "在生活中，学会谦让很重要",
        "生活如舟，载我们前行",
        "日常琐事构成生活全貌",
        "在生活中，保持希望很重要",
        "生活需要梦想照进现实",
        "每个决定都塑造人生",
        "在生活中，学会珍惜很重要",
        "生活如灯塔，指引方向"
    ];
    
    // 通用类答案库（50个）
    const commonAnswers = [
        "事在人为",
        "车到山前必有路",
        "船到桥头自然直",
        "答案在水到渠成时自然出现",
        "好事多磨",
        "否极泰来",
        "物极必反",
        "顺其自然",
        "一切都是最好的安排",
        "时间会给出最好的答案",
        "先做你能做的，其余的交给时间",
        "相信过程比相信结果更重要",
        "每个选择都有其存在的理由",
        "看似无关的事物往往暗含线索",
        "有时候后退是为了更好地前进",
        "答案可能就在下一个转角",
        "换个环境可能会有新发现",
        "静下心来，世界会变得更清晰",
        "相信自己的直觉",
        "好事不在忙中错",
        "慢工出细活",
        "水滴石穿",
        "聚沙成塔",
        "千里之行，始于足下",
        "青出于蓝而胜于蓝",
        "书山有路勤为径",
        "学海无涯苦作舟",
        "磨刀不误砍柴工",
        "工欲善其事，必先利其器",
        "临渊羡鱼，不如退而结网",
        "授人以鱼不如授人以渔",
        "塞翁失马，焉知非福",
        "万事开头难",
        "一分耕耘，一分收获",
        "失败是成功之母",
        "天道酬勤",
        "厚德载物",
        "知足者常乐",
        "细节决定成败",
        "坚持就是胜利",
        "态度决定一切",
        "行动胜于空谈",
        "机遇只给有准备的人",
        "宝剑锋从磨砺出",
        "梅花香自苦寒来",
        "山重水复疑无路",
        "柳暗花明又一村"
    ];
    
    // 根据当前场景选择对应的答案库
    const sceneMap = {
        'job': jobAnswers,
        'love': loveAnswers,
        'daily': dailyAnswers,
        'default': commonAnswers
    };
    
    // 获取当前场景对应的答案库
    const currentScene = this.currentScene || 'default';
    const categoryAnswers = sceneMap[currentScene] || sceneMap['default'];
    
    // 合并通用答案到选择结果中
    return categoryAnswers.concat(commonAnswers);
}
```

---

## 📊 流程特点分析

### 1. 双重模式设计
- **梅花易数模式**：实时生成个性化卦象分析
- **感应答案模式**：从固定答案库随机选择

### 2. 真实卦象呈现
- **如实反映**：按照原本卦象含义陈述，不强制积极化
- **适度鼓励**：仅在不利卦象时添加"事在人为"等补充话语
- **平衡表达**：既不回避困难，也不夸大乐观

### 3. 用户体验优化
- **流式响应**：实时显示GPT生成的文字
- **打字机效果**：模拟真实的思考过程
- **最小停留时间**：保证3秒的体验时间

### 4. 健壮性保障
- **超时控制**：30秒自动超时
- **错误处理**：API失败时使用降级方案
- **数据验证**：确保输入数据的完整性

---

## 🔄 完整调用链路

```
用户点击"获得启示" 
    ↓
问题分类判断（梅花易数 vs 感应答案）
    ↓
构建对应的System Prompt + User Prompt
    ↓
调用GPT-3.5-turbo API（流式响应）
    ↓
解析流式数据，拼接完整响应
    ↓
梅花易数答案进行格式化处理
    ↓
隐藏过渡模块，显示答案模块
    ↓
打字机效果显示最终答案
    ↓
更新收藏按钮状态
    ↓
用户看到完整答案
```

---

## 💡 技术亮点

### 1. Prompt工程
- **精准的角色定位**：专业玄学大师 vs 古老答案之书守护精灵
- **严格的回答约束**：字数量限制、语言风格要求
- **明确的任务定义**：不分析问题，直接选择固定答案

### 2. 流式处理
- **实时响应**：边生成边显示，提升用户体验
- **增量拼接**：动态构建完整答案
- **错误容错**：单行解析失败不影响整体

### 3. 真实与鼓励的平衡
- **如实呈现**：不强制过滤消极内容，保持卦象真实性
- **适度补充**：仅在不利情况下添加鼓励话语作为补充
- **长度控制**：防止过长回答影响体验
- **默认保障**：确保始终有答案返回

---

**总结：这是一个完整的AI驱动的占卜系统，从用户输入到最终答案展示，每个环节都经过精心设计，既保证了功能完整性，又优化了用户体验。**